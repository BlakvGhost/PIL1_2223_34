{% extends 'base/base.html' %}
{% load humanize %}

{% block 'title' %} Emplois du temps {% endblock %}

{% block 'main' %}
<link href="/static/plugins/custom/fullcalendar/fullcalendar.bundle.css" rel="stylesheet" type="text/css" />
<div class="d-flex flex-column flex-column-fluid" id="main">
    <div id="kt_app_toolbar" class="app-toolbar py-4 py-lg-8">
        <div id="kt_app_toolbar_container" class="app-container container-xxl d-flex flex-stack">
            <div class="page-title d-flex flex-column justify-content-center flex-wrap me-3">
                <h1 class="page-heading d-flex text-dark fw-bold fs-3 flex-column justify-content-center my-0">
                    {% if user.is_staff or user.is_superuser %} Programmer/Editer des Emplois du temps
                    {% elif user.is_teacher %} Votre Programme {% else %} Vos
                    Emplois du temps de la {{ user.level.slug }} {% endif %}
                </h1>
            </div>
        </div>
    </div>
    <div id="kt_app_content" class="app-content flex-column-fluid">
        <!--begin::Content container-->
        <div id="kt_app_content_container" class="app-container container-xxl">
            <!--begin::Card-->
            <div class="card">
                <!--begin::Card header-->
                <div class="card-header">
                    {% if user.is_staff or user.is_superuser %}
                    <div class="align-self-center w-lg-auto w-100 my-2">
                        <select v-model="filterLevel" @change="switchLevel" id="switchLevel"
                            aria-label="Selectionner une salle de classe"
                            data-placeholder="Selectionner une salle de classe..." class="form-select form-control">
                            <option value="default"> Toutes les classes </option>
                            {% for cl in levels %}
                            <option value="{{ cl.id }}">
                                {{ cl.slug }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="card-toolbar w-lg-auto w-100 my-2">
                        <button class="btn btn-flex btn-primary bg-app-secondary w-lg-auto w-100 justify-content-center"
                            data-kt-calendar="add" data-bs-toggle="modal" data-bs-target="#kt_modal_add_event">
                            <!--begin::Svg Icon | path: icons/duotune/arrows/arr075.svg-->
                            <span class="svg-icon svg-icon-2 svg-light">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <rect opacity="0.5" x="11.364" y="20.364" width="16" height="2" rx="1"
                                        transform="rotate(-90 11.364 20.364)" fill="currentColor" />
                                    <rect x="4.36396" y="11.364" width="16" height="2" rx="1" fill="currentColor" />
                                </svg>
                            </span>
                            <!--end::Svg Icon-->
                            Ajouter Un Programme</button>
                    </div>
                    {% endif %}
                </div>
                <!--end::Card header-->
                <!--begin::Card body-->
                <div class="card-body">
                    <!--begin::Calendar-->
                    <div v-if="loadingCalendar">
                        <div class="card-header mt-2 placeholder-glow justify-content-start">
                            <button class="btn col col-md-6 col-lg-3 me-3 btn-primary bg-jma disabled placeholder">
                            </button>
                            <button class="btn col col-md-6 col-lg-3 me-3 btn-primary bg-jma disabled placeholder">
                            </button>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title placeholder-glow">
                                <span class="placeholder col-6"></span>
                            </h5>
                            <p class="card-text placeholder-glow">
                                <span class="placeholder col-7"></span>
                                <span class="placeholder col-4"></span>
                                <span class="placeholder col-4"></span>
                                <span class="placeholder col-6"></span>
                                <span class="placeholder col-8"></span>
                            </p>
                            <a href="#" tabindex="-1" class="btn btn-primary disabled placeholder col-6"></a>
                        </div>
                        <div class="card-footer">
                            <h5 class="card-title placeholder-glow">
                                <span class="placeholder col-6"></span>
                            </h5>
                            <p class="card-text placeholder-glow">
                                <span class="placeholder col-7"></span>
                                <span class="placeholder col-4"></span>
                                <span class="placeholder col-4"></span>
                                <span class="placeholder col-6"></span>
                                <span class="placeholder col-8"></span>
                            </p>
                        </div>
                    </div>
                    <div id="kt_calendar_app">

                    </div>
                    <!--end::Calendar-->
                </div>
                <!--end::Card body-->
            </div>
            <!--end::Card-->
            <!--begin::Modals-->
            <!--begin::Modal - New Product-->
            <div class="modal fade" id="kt_modal_add_event" tabindex="-1" aria-hidden="true">
                <!--begin::Modal dialog-->
                <div class="modal-dialog modal-dialog-centered mw-750px">
                    <!--begin::Modal content-->
                    <div class="modal-content">
                        <!--begin::Form-->
                        <form class="form" id="kt_modal_add_event_form" method="POST" @submit.prevent="addShedule">
                            <!--begin::Modal header-->
                            <div class="modal-header">
                                <!--begin::Modal title-->
                                <h2 class="fw-bold" data-kt-calendar="title">Ajouter un évernement</h2>
                                <!--end::Modal title-->
                                <!--begin::Close-->
                                <div data-bs-dismiss="modal" class="btn btn-icon btn-sm btn-active-icon-primary"
                                    id="kt_modal_add_event_close">
                                    <!--begin::Svg Icon | path: icons/duotune/arrows/arr061.svg-->
                                    <span class="svg-icon svg-icon-1">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <rect opacity="0.5" x="6" y="17.3137" width="16" height="2" rx="1"
                                                transform="rotate(-45 6 17.3137)" fill="currentColor" />
                                            <rect x="7.41422" y="6" width="16" height="2" rx="1"
                                                transform="rotate(45 7.41422 6)" fill="currentColor" />
                                        </svg>
                                    </span>
                                    <!--end::Svg Icon-->
                                </div>
                                <!--end::Close-->
                            </div>
                            <!--end::Modal header-->
                            <!--begin::Modal body-->
                            <div class="modal-body py-10 px-lg-17">
                                <div class="row row-cols-1 row-cols-lg-2">
                                    <div class="fv-row mb-9">
                                        <!--begin::Label-->
                                        <label class="fs-6 fw-semibold mb-2">Nom de L'enseignant</label>
                                        <!--end::Label-->
                                        <!--begin::Input-->
                                        <select required name="teacher" aria-label="Selectionner un enseignant"
                                            data-control="select2-custom"
                                            data-placeholder="Selectionner un enseignant..."
                                            class="form-select form-select-solid form-select-lg fw-semibold">
                                            <option>Selectionner un enseignant</option>
                                            {% for teacher in teachers %}
                                            <option value="{{ teacher.id }}">
                                                {{ teacher.first_name }} {{ teacher.last_name }}
                                            </option>
                                            {% endfor %}
                                        </select>
                                        <!--end::Input-->
                                    </div>
                                    <div class="fv-row mb-9">
                                        <!--begin::Label-->
                                        <label class="fs-6 fw-semibold mb-2">Selectionner la matière</label>
                                        <!--end::Label-->
                                        <!--begin::Input-->
                                        <select required name="subject" aria-label="Selectionner une matière"
                                            data-control="select2-custom" data-placeholder="La matière"
                                            class="form-select form-select-solid form-select-lg fw-semibold">
                                            {% for subject in subjects %}
                                            <option value="{{ subject.id }}">
                                                {{ subject.slug }} de {{ subject.level.slug }}
                                            </option>
                                            {% endfor %}
                                        </select>
                                        <!--end::Input-->
                                    </div>
                                    <!--end::Input group-->
                                </div>
                                <div class="row row-cols-1">
                                    <!--begin::Input group-->
                                    <div class="fv-row mb-9">
                                        <!--begin::Label-->
                                        <label class="fs-6 fw-semibold mb-2">Selectionner Une salle de classe</label>
                                        <!--end::Label-->
                                        <select required name="classroom" aria-label="Selectionner une salle de classe"
                                            data-control="select2-custom"
                                            data-placeholder="Selectionner une salle de classe..."
                                            class="form-select form-select-solid form-select-lg fw-semibold">
                                            {% for cl in classrooms %}
                                            <option value="{{ cl.id }}">
                                                {{ cl.slug }}
                                            </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <!--begin::Input group-->
                                <div class="row row-cols-lg-2 g-10">
                                    <div class="col">
                                        <div class="fv-row mb-9">
                                            <!--begin::Label-->
                                            <label class="fs-6 fw-semibold mb-2">Date de début</label>
                                            <!--end::Label-->
                                            <!--begin::Input-->
                                            <input class="form-control form-control-solid" name="start_date"
                                                placeholder="Picker la date de début"
                                                id="kt_calendar_datepicker_start_date" />
                                            <!--end::Input-->
                                        </div>
                                    </div>
                                    <div class="col" data-kt-calendar="datepicker">
                                        <div class="fv-row mb-9">
                                            <!--begin::Label-->
                                            <label class="fs-6 fw-semibold mb-2">heure de début</label>
                                            <!--end::Label-->
                                            <!--begin::Input-->
                                            <input class="form-control form-control-solid" name="start_time"
                                                placeholder="Picker l'heure de début"
                                                id="kt_calendar_datepicker_start_time" />
                                            <!--end::Input-->
                                        </div>
                                    </div>
                                </div>
                                <!--end::Input group-->
                                <!--begin::Input group-->
                                <div class="row row-cols-lg-2 g-10">
                                    <div class="col">
                                        <div class="fv-row mb-9">
                                            <!--begin::Label-->
                                            <label class="fs-6 fw-semibold mb-2">Date de Fin</label>
                                            <!--end::Label-->
                                            <!--begin::Input-->
                                            <input required class="form-control form-control-solid" name="end_date"
                                                placeholder="Picker la date de fin"
                                                id="kt_calendar_datepicker_end_date" />
                                            <!--end::Input-->
                                        </div>
                                    </div>
                                    <div class="col" data-kt-calendar="datepicker">
                                        <div class="fv-row mb-9">
                                            <!--begin::Label-->
                                            <label class="fs-6 fw-semibold mb-2">Heure de Fin</label>
                                            <!--end::Label-->
                                            <!--begin::Input-->
                                            <input required class="form-control form-control-solid" name="end_time"
                                                placeholder="Picker l'heure de fin"
                                                id="kt_calendar_datepicker_end_time" />
                                            <!--end::Input-->
                                        </div>
                                    </div>
                                </div>
                                <!--end::Input group-->
                            </div>
                            <!--end::Modal body-->
                            <!--begin::Modal footer-->
                            <div class="modal-footer flex-center">
                                <!--begin::Button-->
                                <button type="reset" id="kt_modal_add_event_cancel" class="btn btn-light me-3"
                                    data-bs-dismiss="modal">Annuler</button>
                                <!--end::Button-->
                                <!--begin::Button-->
                                <button v-if="!checking" type="submit" id="kt_modal_add_event_submit"
                                    class="btn btn-primary">
                                    <span class="indicator-label">Enregistrer</span>
                                    <span class="indicator-progress">Patientez...
                                        <span class="spinner-border spinner-border-sm align-middle ms-2"></span></span>
                                </button>
                                <button v-if="checking" class="btn btn-success bg-app-secondary mx-2 fw-bold text-light"
                                    type="button" disabled id="checkingBtn">
                                    <span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>
                                    Patientez...
                                </button>
                                <!--end::Button-->
                            </div>
                            <!--end::Modal footer-->
                        </form>
                        <!--end::Form-->
                    </div>
                </div>
            </div>
            <div class="modal fade" id="kt_modal_edit_event" tabindex="-1" aria-hidden="true">
                <!--begin::Modal dialog-->
                <div class="modal-dialog modal-dialog-centered mw-750px">
                    <!--begin::Modal content-->
                    <div class="modal-content">
                        <!--begin::Form-->
                        <form class="form" id="kt_modal_edit_event_form" method="POST" @submit.prevent="updateShedule">
                            <!--begin::Modal header-->
                            <div class="modal-header">
                                <!--begin::Modal title-->
                                <h2 class="fw-bold" data-kt-calendar="title"> Editer [[ clickedElt?.title ]] </h2>
                                <!--end::Modal title-->
                                <!--begin::Close-->
                                <div data-bs-dismiss="modal" class="btn btn-icon btn-sm btn-active-icon-primary"
                                    id="kt_modal_add_event_close">
                                    <!--begin::Svg Icon | path: icons/duotune/arrows/arr061.svg-->
                                    <span class="svg-icon svg-icon-1">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <rect opacity="0.5" x="6" y="17.3137" width="16" height="2" rx="1"
                                                transform="rotate(-45 6 17.3137)" fill="currentColor" />
                                            <rect x="7.41422" y="6" width="16" height="2" rx="1"
                                                transform="rotate(45 7.41422 6)" fill="currentColor" />
                                        </svg>
                                    </span>
                                    <!--end::Svg Icon-->
                                </div>
                                <!--end::Close-->
                            </div>
                            <!--end::Modal header-->
                            <!--begin::Modal body-->
                            <div class="modal-body py-10 px-lg-17">
                                <div class="row row-cols-1 row-cols-lg-2">
                                    <div class="fv-row mb-9">
                                        <!--begin::Label-->
                                        <label class="fs-6 fw-semibold mb-2">Nom de L'enseignant</label>
                                        <!--end::Label-->
                                        <!--begin::Input-->
                                        <select required name="teacher" aria-label="Selectionner un enseignant"
                                            data-control="select3-custom"
                                            data-placeholder="Selectionner un enseignant..."
                                            class="form-select form-select-solid form-select-lg fw-semibold">
                                            <option>Selectionner un enseignant</option>
                                            {% for teacher in teachers %}
                                            <option value="{{ teacher.id }}"
                                                :selected="clickedElt?.teacher?.id == {{ teacher.id }}">
                                                {{ teacher.first_name }} {{ teacher.last_name }}
                                            </option>
                                            {% endfor %}
                                        </select>
                                        <!--end::Input-->
                                    </div>
                                    <div class="fv-row mb-9">
                                        <!--begin::Label-->
                                        <label class="fs-6 fw-semibold mb-2">Selectionner la matière</label>
                                        <!--end::Label-->
                                        <!--begin::Input-->
                                        <select required name="subject" aria-label="Selectionner une matière"
                                            data-control="select3-custom" data-placeholder="La matière"
                                            class="form-select form-select-solid form-select-lg fw-semibold">
                                            {% for subject in subjects %}
                                            <option value="{{ subject.id }}"
                                                :selected="clickedElt?.subject?.id == {{ subject.id }}">
                                                {{ subject.slug }} de {{ subject.level.slug }}
                                            </option>
                                            {% endfor %}
                                        </select>
                                        <!--end::Input-->
                                    </div>
                                    <!--end::Input group-->
                                </div>
                                <div class="row row-cols-1">
                                    <!--begin::Input group-->
                                    <div class="fv-row mb-9">
                                        <!--begin::Label-->
                                        <label class="fs-6 fw-semibold mb-2">Selectionner Une salle de classe</label>
                                        <!--end::Label-->
                                        <select required name="classroom" aria-label="Selectionner une salle de classe"
                                            data-control="select3-custom"
                                            data-placeholder="Selectionner une salle de classe..."
                                            class="form-select form-select-solid form-select-lg fw-semibold">
                                            {% for cl in classrooms %}
                                            <option value="{{ cl.id }}"
                                                :selected="clickedElt?.classroom?.id == {{ cl.id }}">
                                                {{ cl.slug }}
                                            </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <!--begin::Input group-->
                                <div class="row row-cols-lg-2 g-10">
                                    <div class="col">
                                        <div class="fv-row mb-9">
                                            <!--begin::Label-->
                                            <label class="fs-6 fw-semibold mb-2">Date de début</label>
                                            <!--end::Label-->
                                            <!--begin::Input-->
                                            <input class="form-control form-control-solid" name="start_date"
                                                placeholder="Picker la date de début"
                                                id="kt_calendar_datepicker_start_date"
                                                :value="[[ clickedElt?.start_date ]]" />
                                            <!--end::Input-->
                                        </div>
                                    </div>
                                    <div class="col" data-kt-calendar="datepicker">
                                        <div class="fv-row mb-9">
                                            <!--begin::Label-->
                                            <label class="fs-6 fw-semibold mb-2">heure de début</label>
                                            <!--end::Label-->
                                            <!--begin::Input-->
                                            <input class="form-control form-control-solid" name="start_time"
                                                placeholder="Picker l'heure de début"
                                                id="kt_calendar_datepicker_start_time"
                                                :value="[[ clickedElt?.start_time ]]" />
                                            <!--end::Input-->
                                        </div>
                                    </div>
                                </div>
                                <!--end::Input group-->
                                <!--begin::Input group-->
                                <div class="row row-cols-lg-2 g-10">
                                    <div class="col">
                                        <div class="fv-row mb-9">
                                            <!--begin::Label-->
                                            <label class="fs-6 fw-semibold mb-2">Date de Fin</label>
                                            <!--end::Label-->
                                            <!--begin::Input-->
                                            <input required class="form-control form-control-solid" name="end_date"
                                                placeholder="Picker la date de fin" id="kt_calendar_datepicker_end_date"
                                                :value="[[ clickedElt?.end_date ]]" />
                                            <!--end::Input-->
                                        </div>
                                    </div>
                                    <div class="col" data-kt-calendar="datepicker">
                                        <div class="fv-row mb-9">
                                            <!--begin::Label-->
                                            <label class="fs-6 fw-semibold mb-2">Heure de Fin</label>
                                            <!--end::Label-->
                                            <!--begin::Input-->
                                            <input required class="form-control form-control-solid" name="end_time"
                                                placeholder="Picker l'heure de fin" id="kt_calendar_datepicker_end_time"
                                                :value="[[ clickedElt?.end_time ]]" />
                                            <!--end::Input-->
                                        </div>
                                    </div>
                                </div>
                                <!--end::Input group-->
                            </div>
                            <!--end::Modal body-->
                            <!--begin::Modal footer-->
                            <div class="modal-footer flex-center">
                                <!--begin::Button-->
                                <button type="reset" id="kt_modal_add_event_cancel" class="btn btn-light me-3"
                                    data-bs-dismiss="modal">Annuler</button>
                                <!--end::Button-->
                                <!--begin::Button-->
                                <button v-if="!checking" type="submit" id="kt_modal_add_event_submit"
                                    class="btn btn-primary">
                                    <span class="indicator-label">Editer</span>
                                    <span class="indicator-progress">Patientez...
                                        <span class="spinner-border spinner-border-sm align-middle ms-2"></span></span>
                                </button>
                                <button v-if="checking" class="btn btn-success bg-app-secondary mx-2 fw-bold text-light"
                                    type="button" disabled id="checkingBtn">
                                    <span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>
                                    Patientez...
                                </button>
                                <!--end::Button-->
                            </div>
                            <!--end::Modal footer-->
                        </form>
                        <!--end::Form-->
                    </div>
                </div>
            </div>
            <!--end::Modal - New Product-->
            <!--begin::Modal - New Product-->
            <div class="modal fade" id="kt_modal_view_event" tabindex="-1" aria-hidden="true">
                <!--begin::Modal dialog-->
                <div class="modal-dialog modal-dialog-centered mw-650px">
                    <!--begin::Modal content-->
                    <div class="modal-content">
                        <!--begin::Modal header-->
                        <div class="modal-header border-0 justify-content-end">
                            <!-- <h3> [[ clickedElt.title ]] </h3> -->
                            <div class="d-flex justify-content-end">
                                <!--begin::Edit-->
                                {% if user.is_staff or user.is_superuser or user.is_teacher %}
                                <form action="{% url 'chats.start' %}" method="post">
                                    {% csrf_token %}
                                    <input type="hidden" name="shedule_id" :value="clickedElt?.id">
                                    <button type="submit"
                                        class="btn btn-icon btn-sm btn-color-gray-400 btn-active-icon-primary me-2"
                                        data-bs-dismiss="click" title="Ouvrir une discussions à partir de ceprogramme"
                                        data-bs-toggle="tooltip">
                                        <!--begin::Svg Icon | path: icons/duotune/art/art005.svg-->
                                        <span class="svg-icon svg-icon-2">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <path opacity="0.3"
                                                    d="M20 3H4C2.89543 3 2 3.89543 2 5V16C2 17.1046 2.89543 18 4 18H4.5C5.05228 18 5.5 18.4477 5.5 19V21.5052C5.5 22.1441 6.21212 22.5253 6.74376 22.1708L11.4885 19.0077C12.4741 18.3506 13.6321 18 14.8167 18H20C21.1046 18 22 17.1046 22 16V5C22 3.89543 21.1046 3 20 3Z"
                                                    fill="currentColor"></path>
                                                <rect x="6" y="12" width="7" height="2" rx="1" fill="currentColor">
                                                </rect>
                                                <rect x="6" y="7" width="12" height="2" rx="1" fill="currentColor">
                                                </rect>
                                            </svg>
                                        </span>
                                        <!--end::Svg Icon-->
                                    </button>
                                </form>
                                {% endif %}
                                {% if user.is_staff or user.is_superuser %}
                                <div class="btn btn-icon btn-sm btn-color-gray-400 btn-active-icon-primary me-2"
                                    data-bs-dismiss="click" title="Editer ce programme" data-bs-toggle="modal"
                                    data-bs-target="#kt_modal_edit_event">
                                    <!--begin::Svg Icon | path: icons/duotune/art/art005.svg-->
                                    <span class="svg-icon svg-icon-2">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path opacity="0.3"
                                                d="M21.4 8.35303L19.241 10.511L13.485 4.755L15.643 2.59595C16.0248 2.21423 16.5426 1.99988 17.0825 1.99988C17.6224 1.99988 18.1402 2.21423 18.522 2.59595L21.4 5.474C21.7817 5.85581 21.9962 6.37355 21.9962 6.91345C21.9962 7.45335 21.7817 7.97122 21.4 8.35303ZM3.68699 21.932L9.88699 19.865L4.13099 14.109L2.06399 20.309C1.98815 20.5354 1.97703 20.7787 2.03189 21.0111C2.08674 21.2436 2.2054 21.4561 2.37449 21.6248C2.54359 21.7934 2.75641 21.9115 2.989 21.9658C3.22158 22.0201 3.4647 22.0084 3.69099 21.932H3.68699Z"
                                                fill="currentColor" />
                                            <path
                                                d="M5.574 21.3L3.692 21.928C3.46591 22.0032 3.22334 22.0141 2.99144 21.9594C2.75954 21.9046 2.54744 21.7864 2.3789 21.6179C2.21036 21.4495 2.09202 21.2375 2.03711 21.0056C1.9822 20.7737 1.99289 20.5312 2.06799 20.3051L2.696 18.422L5.574 21.3ZM4.13499 14.105L9.891 19.861L19.245 10.507L13.489 4.75098L4.13499 14.105Z"
                                                fill="currentColor" />
                                        </svg>
                                    </span>
                                    <!--end::Svg Icon-->
                                </div>
                                <!--end::Edit-->
                                <!--begin::Edit-->
                                <div class="btn btn-icon btn-sm btn-color-gray-400 btn-active-icon-danger me-2"
                                    data-bs-toggle="tooltip" data-bs-dismiss="click" title="Supprimer ce programme"
                                    id="kt_modal_view_event_delete" @click.prevent="handleDeleteEvent">
                                    <!--begin::Svg Icon | path: icons/duotune/general/gen027.svg-->
                                    <span class="svg-icon svg-icon-2">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path
                                                d="M5 9C5 8.44772 5.44772 8 6 8H18C18.5523 8 19 8.44772 19 9V18C19 19.6569 17.6569 21 16 21H8C6.34315 21 5 19.6569 5 18V9Z"
                                                fill="currentColor" />
                                            <path opacity="0.5"
                                                d="M5 5C5 4.44772 5.44772 4 6 4H18C18.5523 4 19 4.44772 19 5V5C19 5.55228 18.5523 6 18 6H6C5.44772 6 5 5.55228 5 5V5Z"
                                                fill="currentColor" />
                                            <path opacity="0.5"
                                                d="M9 4C9 3.44772 9.44772 3 10 3H14C14.5523 3 15 3.44772 15 4V4H9V4Z"
                                                fill="currentColor" />
                                        </svg>
                                    </span>
                                    <!--end::Svg Icon-->
                                </div>
                                <!--end::Edit-->
                                {% endif %}
                                <!--begin::Close-->
                                <div class="btn btn-icon btn-sm btn-color-gray-500 btn-active-icon-primary"
                                    data-bs-toggle="tooltip" title="Fermer ce programme" data-bs-dismiss="modal">
                                    <!--begin::Svg Icon | path: icons/duotune/arrows/arr061.svg-->
                                    <span class="svg-icon svg-icon-1">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <rect opacity="0.5" x="6" y="17.3137" width="16" height="2" rx="1"
                                                transform="rotate(-45 6 17.3137)" fill="currentColor" />
                                            <rect x="7.41422" y="6" width="16" height="2" rx="1"
                                                transform="rotate(45 7.41422 6)" fill="currentColor" />
                                        </svg>
                                    </span>
                                    <!--end::Svg Icon-->
                                </div>
                                <!--end::Close-->
                            </div>
                        </div>
                        <!--end::Modal header-->
                        <!--begin::Modal body-->
                        <div class="modal-body pt-0 pb-20 px-lg-17">
                            <!--begin::Row-->
                            <div class="d-flex">
                                <!--begin::Icon-->
                                <!--begin::Svg Icon | path: icons/duotune/general/gen014.svg-->
                                <span class="svg-icon svg-icon-1 svg-icon-muted me-5">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path opacity="0.3"
                                            d="M21 22H3C2.4 22 2 21.6 2 21V5C2 4.4 2.4 4 3 4H21C21.6 4 22 4.4 22 5V21C22 21.6 21.6 22 21 22Z"
                                            fill="currentColor" />
                                        <path
                                            d="M6 6C5.4 6 5 5.6 5 5V3C5 2.4 5.4 2 6 2C6.6 2 7 2.4 7 3V5C7 5.6 6.6 6 6 6ZM11 5V3C11 2.4 10.6 2 10 2C9.4 2 9 2.4 9 3V5C9 5.6 9.4 6 10 6C10.6 6 11 5.6 11 5ZM15 5V3C15 2.4 14.6 2 14 2C13.4 2 13 2.4 13 3V5C13 5.6 13.4 6 14 6C14.6 6 15 5.6 15 5ZM19 5V3C19 2.4 18.6 2 18 2C17.4 2 17 2.4 17 3V5C17 5.6 17.4 6 18 6C18.6 6 19 5.6 19 5Z"
                                            fill="currentColor" />
                                        <path
                                            d="M8.8 13.1C9.2 13.1 9.5 13 9.7 12.8C9.9 12.6 10.1 12.3 10.1 11.9C10.1 11.6 10 11.3 9.8 11.1C9.6 10.9 9.3 10.8 9 10.8C8.8 10.8 8.59999 10.8 8.39999 10.9C8.19999 11 8.1 11.1 8 11.2C7.9 11.3 7.8 11.4 7.7 11.6C7.6 11.8 7.5 11.9 7.5 12.1C7.5 12.2 7.4 12.2 7.3 12.3C7.2 12.4 7.09999 12.4 6.89999 12.4C6.69999 12.4 6.6 12.3 6.5 12.2C6.4 12.1 6.3 11.9 6.3 11.7C6.3 11.5 6.4 11.3 6.5 11.1C6.6 10.9 6.8 10.7 7 10.5C7.2 10.3 7.49999 10.1 7.89999 10C8.29999 9.90003 8.60001 9.80003 9.10001 9.80003C9.50001 9.80003 9.80001 9.90003 10.1 10C10.4 10.1 10.7 10.3 10.9 10.4C11.1 10.5 11.3 10.8 11.4 11.1C11.5 11.4 11.6 11.6 11.6 11.9C11.6 12.3 11.5 12.6 11.3 12.9C11.1 13.2 10.9 13.5 10.6 13.7C10.9 13.9 11.2 14.1 11.4 14.3C11.6 14.5 11.8 14.7 11.9 15C12 15.3 12.1 15.5 12.1 15.8C12.1 16.2 12 16.5 11.9 16.8C11.8 17.1 11.5 17.4 11.3 17.7C11.1 18 10.7 18.2 10.3 18.3C9.9 18.4 9.5 18.5 9 18.5C8.5 18.5 8.1 18.4 7.7 18.2C7.3 18 7 17.8 6.8 17.6C6.6 17.4 6.4 17.1 6.3 16.8C6.2 16.5 6.10001 16.3 6.10001 16.1C6.10001 15.9 6.2 15.7 6.3 15.6C6.4 15.5 6.6 15.4 6.8 15.4C6.9 15.4 7.00001 15.4 7.10001 15.5C7.20001 15.6 7.3 15.6 7.3 15.7C7.5 16.2 7.7 16.6 8 16.9C8.3 17.2 8.6 17.3 9 17.3C9.2 17.3 9.5 17.2 9.7 17.1C9.9 17 10.1 16.8 10.3 16.6C10.5 16.4 10.5 16.1 10.5 15.8C10.5 15.3 10.4 15 10.1 14.7C9.80001 14.4 9.50001 14.3 9.10001 14.3C9.00001 14.3 8.9 14.3 8.7 14.3C8.5 14.3 8.39999 14.3 8.39999 14.3C8.19999 14.3 7.99999 14.2 7.89999 14.1C7.79999 14 7.7 13.8 7.7 13.7C7.7 13.5 7.79999 13.4 7.89999 13.2C7.99999 13 8.2 13 8.5 13H8.8V13.1ZM15.3 17.5V12.2C14.3 13 13.6 13.3 13.3 13.3C13.1 13.3 13 13.2 12.9 13.1C12.8 13 12.7 12.8 12.7 12.6C12.7 12.4 12.8 12.3 12.9 12.2C13 12.1 13.2 12 13.6 11.8C14.1 11.6 14.5 11.3 14.7 11.1C14.9 10.9 15.2 10.6 15.5 10.3C15.8 10 15.9 9.80003 15.9 9.70003C15.9 9.60003 16.1 9.60004 16.3 9.60004C16.5 9.60004 16.7 9.70003 16.8 9.80003C16.9 9.90003 17 10.2 17 10.5V17.2C17 18 16.7 18.4 16.2 18.4C16 18.4 15.8 18.3 15.6 18.2C15.4 18.1 15.3 17.8 15.3 17.5Z"
                                            fill="currentColor" />
                                    </svg>
                                </span>
                                <!--end::Svg Icon-->
                                <!--end::Icon-->
                                <div class="mb-9">
                                    <!--begin::Event name-->
                                    <div class="d-flex align-items-center mb-2">
                                        <span class="fs-3 fw-bold me-3" id="viewTitle"> [[ clickedElt.title ]] </span>
                                    </div>
                                    <!--end::Event name-->
                                    <!--begin::Event description-->
                                    <div class="fs-6" id="viewDesc">
                                        [[ clickedElt?.subject?.desc ]]
                                    </div>
                                    <!--end::Event description-->
                                </div>
                            </div>
                            <!--end::Row-->
                            <!--begin::Row-->
                            <div class="d-flex mb-2">
                                <!--begin::Icon-->
                                <!--begin::Svg Icon | path: icons/duotune/abstract/abs050.svg-->
                                <span class="svg-icon svg-icon-1 svg-icon-success me-5">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px"
                                        viewBox="0 0 24 24" version="1.1">
                                        <circle fill="currentColor" cx="12" cy="12" r="8" />
                                    </svg>
                                </span>
                                <!--end::Svg Icon-->
                                <!--end::Icon-->
                                <!--begin::Event start date/time-->
                                <div class="fs-6">
                                    <span class="fw-bold">Commence: </span>
                                    <div class="p-3">

                                        <div class="timeline-label">
                                            <!--begin::Item-->
                                            <div class="timeline-item">
                                                <!--begin::Label-->
                                                <div class="timeline-label fw-bold text-gray-800 fs-6">Date</div>
                                                <!--end::Label-->
                                                <!--begin::Badge-->
                                                <div class="timeline-badge">
                                                    <i class="fa fa-genderless text-warning fs-1"> </i>
                                                </div>
                                                <!--end::Badge-->
                                                <div class="timeline-content d-flex">
                                                    <span class="text-gray-800 ps-3"> [[ clickedElt?.start_date ]]
                                                    </span>
                                                </div>
                                            </div>
                                            <!--end::Item-->
                                            <!--begin::Item-->
                                            <div class="timeline-item">
                                                <!--begin::Label-->
                                                <div class="timeline-label fw-bold text-gray-800 fs-6">Heure</div>
                                                <!--end::Label-->
                                                <!--begin::Badge-->
                                                <div class="timeline-badge">
                                                    <i class="fa fa-genderless text-success fs-1"></i>
                                                </div>
                                                <!--end::Badge-->
                                                <!--begin::Content-->
                                                <div class="timeline-content d-flex">
                                                    <span class="text-gray-800 ps-3"> [[ clickedElt?.start_time ]]
                                                    </span>
                                                </div>
                                                <!--end::Content-->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--end::Event start date/time-->
                            </div>
                            <!--end::Row-->
                            <!--begin::Row-->
                            <div class="d-flex mb-9">
                                <!--begin::Icon-->
                                <!--begin::Svg Icon | path: icons/duotune/abstract/abs050.svg-->
                                <span class="svg-icon svg-icon-1 svg-icon-danger me-5">
                                    <svg class="text-danger" xmlns="http://www.w3.org/2000/svg" width="24px"
                                        height="24px" viewBox="0 0 24 24" version="1.1">
                                        <circle fill="currentColor" cx="12" cy="12" r="8" />
                                    </svg>
                                </span>
                                <!--end::Svg Icon-->
                                <!--end::Icon-->
                                <!--begin::Event end date/time-->
                                <div class="fs-6">
                                    <span class="fw-bold">Fin: </span>
                                    <div class="p-3">
                                        <div class="timeline-label">
                                            <!--begin::Item-->
                                            <div class="timeline-item">
                                                <!--begin::Label-->
                                                <div class="timeline-label fw-bold text-gray-800 fs-6">Date</div>
                                                <!--end::Label-->
                                                <!--begin::Badge-->
                                                <div class="timeline-badge">
                                                    <i class="fa fa-genderless text-warning fs-1"> </i>
                                                </div>
                                                <!--end::Badge-->
                                                <div class="timeline-content d-flex">
                                                    <span class="text-gray-800 ps-3"> [[ clickedElt?.end_date ]]
                                                    </span>
                                                </div>
                                            </div>
                                            <!--end::Item-->
                                            <!--begin::Item-->
                                            <div class="timeline-item">
                                                <!--begin::Label-->
                                                <div class="timeline-label fw-bold text-gray-800 fs-6">Heure</div>
                                                <!--end::Label-->
                                                <!--begin::Badge-->
                                                <div class="timeline-badge">
                                                    <i class="fa fa-genderless text-success fs-1"></i>
                                                </div>
                                                <!--end::Badge-->
                                                <!--begin::Content-->
                                                <div class="timeline-content d-flex">
                                                    <span class="text-gray-800 ps-3"> [[ clickedElt?.end_time ]]
                                                    </span>
                                                </div>
                                                <!--end::Content-->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--end::Event end date/time-->
                            </div>

                            <div class="d-flex mb-9">
                                <!--begin::Icon-->
                                <!--begin::Svg Icon | path: icons/duotune/abstract/abs050.svg-->
                                <span class="svg-icon svg-icon-1 svg-icon-danger me-5">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path opacity="0.3"
                                            d="M18.4 5.59998C21.9 9.09998 21.9 14.8 18.4 18.3C14.9 21.8 9.2 21.8 5.7 18.3L18.4 5.59998Z"
                                            fill="currentColor"></path>
                                        <path
                                            d="M12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C17.5 22 22 17.5 22 12C22 6.5 17.5 2 12 2ZM19.9 11H13V8.8999C14.9 8.6999 16.7 8.00005 18.1 6.80005C19.1 8.00005 19.7 9.4 19.9 11ZM11 19.8999C9.7 19.6999 8.39999 19.2 7.39999 18.5C8.49999 17.7 9.7 17.2001 11 17.1001V19.8999ZM5.89999 6.90002C7.39999 8.10002 9.2 8.8 11 9V11.1001H4.10001C4.30001 9.4001 4.89999 8.00002 5.89999 6.90002ZM7.39999 5.5C8.49999 4.7 9.7 4.19998 11 4.09998V7C9.7 6.8 8.39999 6.3 7.39999 5.5ZM13 17.1001C14.3 17.3001 15.6 17.8 16.6 18.5C15.5 19.3 14.3 19.7999 13 19.8999V17.1001ZM13 4.09998C14.3 4.29998 15.6 4.8 16.6 5.5C15.5 6.3 14.3 6.80002 13 6.90002V4.09998ZM4.10001 13H11V15.1001C9.1 15.3001 7.29999 16 5.89999 17.2C4.89999 16 4.30001 14.6 4.10001 13ZM18.1 17.1001C16.6 15.9001 14.8 15.2 13 15V12.8999H19.9C19.7 14.5999 19.1 16.0001 18.1 17.1001Z"
                                            fill="currentColor"></path>
                                    </svg>
                                </span>
                                <!--end::Svg Icon-->
                                <!--end::Icon-->
                                <!--begin::Event end date/time-->
                                <div class="fs-6">
                                    <span class="fw-bold">Totale d'heure: </span>

                                    <div class="p-3">

                                        <div class="timeline-label">
                                            <!--begin::Item-->
                                            <div class="timeline-item">
                                                <!--begin::Label-->
                                                <div class="timeline-label fw-bold text-gray-800 fs-6">Total</div>
                                                <!--end::Label-->
                                                <!--begin::Badge-->
                                                <div class="timeline-badge">
                                                    <i class="fa fa-genderless text-warning fs-1"> </i>
                                                </div>
                                                <!--end::Badge-->
                                                <div class="timeline-content d-flex">
                                                    <span class="text-gray-800 ps-3"> [[ clickedElt?.subject?.total_time
                                                        ]] </span>
                                                </div>
                                            </div>
                                            <!--end::Item-->
                                            <!--begin::Item-->
                                            <div class="timeline-item">
                                                <!--begin::Label-->
                                                <div class="timeline-label fw-bold text-gray-800 fs-6">Faite</div>
                                                <!--end::Label-->
                                                <!--begin::Badge-->
                                                <div class="timeline-badge">
                                                    <i class="fa fa-genderless text-success fs-1"></i>
                                                </div>
                                                <!--end::Badge-->
                                                <!--begin::Content-->
                                                <div class="timeline-content d-flex">
                                                    <span class="text-gray-800 ps-3"> [[ clickedElt?.subject?.total_time
                                                        ]] </span>
                                                </div>
                                                <!--end::Content-->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--end::Event end date/time-->
                            </div>
                            <!--end::Row-->
                            <!--begin::Row-->
                            <div class="d-flex mb-3">
                                <!--begin::Icon-->
                                <!--begin::Svg Icon | path: icons/duotune/general/gen018.svg-->
                                <span class="svg-icon svg-icon-1 svg-icon-muted me-5">
                                    <svg width="24" height="24" viewBox="0 0 18 18" fill="none"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path opacity="0.3"
                                            d="M16.5 9C16.5 13.125 13.125 16.5 9 16.5C4.875 16.5 1.5 13.125 1.5 9C1.5 4.875 4.875 1.5 9 1.5C13.125 1.5 16.5 4.875 16.5 9Z"
                                            fill="currentColor"></path>
                                        <path
                                            d="M9 16.5C10.95 16.5 12.75 15.75 14.025 14.55C13.425 12.675 11.4 11.25 9 11.25C6.6 11.25 4.57499 12.675 3.97499 14.55C5.24999 15.75 7.05 16.5 9 16.5Z"
                                            fill="currentColor"></path>
                                        <rect x="7" y="6" width="4" height="4" rx="2" fill="currentColor"></rect>
                                    </svg>
                                </span>
                                <!--end::Svg Icon-->
                                <!--end::Icon-->
                                <div class="fs-6">
                                    <span class="fw-bold">Details Professeur: </span>
                                    <div class="p-3">
                                        <div class="d-flex align-items-center mb-7">
                                            <!--begin::Avatar-->
                                            <div class="symbol symbol-50px me-5">
                                                <img :src="clickedElt?.teacher?.avatar ?? '/static/media/avatars/blank.png'"
                                                    class="" :alt="clickedElt?.teacher?.first_name">
                                            </div>
                                            <!--end::Avatar-->
                                            <!--begin::Text-->
                                            <div class="flex-grow-1">
                                                <a href="#" class="text-dark fw-bold text-hover-primary fs-6"> [[
                                                    clickedElt?.teacher?.first_name ]] [[ clickedElt?.teacher?.last_name
                                                    ]] </a>
                                                <span class="text-muted d-block fw-bold"> [[ clickedElt?.teacher?.email
                                                    ]] </span>
                                            </div>
                                            <!--end::Text-->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--end::Row-->

                            <!--begin::Row-->
                            <div class="d-flex align-items-center">
                                <!--begin::Icon-->
                                <!--begin::Svg Icon | path: icons/duotune/general/gen018.svg-->
                                <span class="svg-icon svg-icon-1 svg-icon-muted me-5">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path opacity="0.3"
                                            d="M18.0624 15.3453L13.1624 20.7453C12.5624 21.4453 11.5624 21.4453 10.9624 20.7453L6.06242 15.3453C4.56242 13.6453 3.76242 11.4453 4.06242 8.94534C4.56242 5.34534 7.46242 2.44534 11.0624 2.04534C15.8624 1.54534 19.9624 5.24534 19.9624 9.94534C20.0624 12.0453 19.2624 13.9453 18.0624 15.3453Z"
                                            fill="currentColor" />
                                        <path
                                            d="M12.0624 13.0453C13.7193 13.0453 15.0624 11.7022 15.0624 10.0453C15.0624 8.38849 13.7193 7.04535 12.0624 7.04535C10.4056 7.04535 9.06241 8.38849 9.06241 10.0453C9.06241 11.7022 10.4056 13.0453 12.0624 13.0453Z"
                                            fill="currentColor" />
                                    </svg>
                                </span>
                                <!--end::Svg Icon-->
                                <!--end::Icon-->
                                <!--begin::Event location-->
                                <div class="fs-6" id="viewLocation">
                                    <span class="fw-bold"> [[ clickedElt?.classroom?.slug ]] </span>
                                    <span class="p-3">
                                        [[ clickedElt?.classroom?.desc ]]
                                    </span>
                                </div>
                                <!--end::Event location-->
                            </div>
                            <!--end::Row-->
                        </div>
                        <!--end::Modal body-->
                    </div>
                </div>
            </div>
            <!--end::Modal - New Product-->
            <!--end::Modals-->
        </div>
        <!--end::Content container-->
    </div>
</div>
{% endblock %}

{% block 'scripts' %}
<script src="/static/plugins/custom/fullcalendar/fullcalendar.bundle.js"></script>
<script src="/static/plugins/custom/datatables/datatables.bundle.js"></script>
<script>
    Vue.createApp({
        delimiters: ['[[', ']]'],
        data() {
            return {
                shedules: [],
                checking: 0,
                calendar: null,
                clickedElt: {},
                filterLevel: 'default',
                loadingCalendar: 1,
            }
        },
        methods: {
            checkBeforeInsert: function (e) {

            },
            switchLevel: function () {
                this.loadingCalendar = true;
                $('body').addClass('overflow-hidden');

                this.getShedules();
            },
            addShedule: function (e) {
                this.checking = 1;
                const data = new FormData(e.target);

                axios.post("{% url 'ajax.shedules.add' %}", data).then(res => {
                    this.calendar.addEvent(res.data.shedule);
                    this.calendar.render();
                    this.shedules.push(res.data.shedule);

                    this.swall({
                        type: 'success',
                        text: res.data.success,
                    });
                    addModal.hide();
                    return this.checking = false;
                }).catch(err => {
                    this.swall({
                        type: 'error',
                        text: err.response.data.error,
                    })
                    return this.checking = false;
                })
            },
            updateShedule: function (e) {
                this.checking = 1;
                const data = new FormData(e.target);
                const id = this.clickedElt.id;

                axios.post(`{% url 'ajax.shedules.add' %}/${id}`, data).then(res => {

                    this.shedules = this.shedules.map(elt => elt.id == id ? res.data.shedule : elt);

                    this.initCalendar();

                    this.swall({
                        type: 'success',
                        text: res.data.success,
                    })
                    editModal.hide();
                    return this.checking = false;
                }).catch(err => {
                    this.swall({
                        type: 'error',
                        text: err.response.data.error,
                    })
                    return this.checking = !false;
                })
            },
            getShedules: function () {
                axios.get(`{% url 'ajax.shedules.get' %}?level=${this.filterLevel}`).then(res => {
                    this.shedules = res.data;
                    this.loadingCalendar = 0;
                    $('body').removeClass('overflow-hidden');

                    this.initCalendar();
                })
            },
            handleDeleteEvent: function () {
                Swal.fire({
                    text: "Etes vous sûr de vouloir supprimer ce programme?",
                    icon: "warning",
                    showCancelButton: true,
                    buttonsStyling: false,
                    confirmButtonText: "Oui, supprimez!",
                    cancelButtonText: "Non, annulez",
                    customClass: {
                        confirmButton: "btn btn-primary",
                        cancelButton: "btn btn-active-light"
                    }
                }).then((result) => {
                    if (result.value) {

                        const data = {
                            shedule_id: this.clickedElt.id,
                        };

                        axios.post(`{% url 'ajax.shedules.destroy' %}`, data).then(res => {

                            this.swall({
                                type: 'success',
                                text: res.data.success,
                            })

                            this.calendar.getEventById(this.clickedElt.id).remove();
                            editModal.hide();
                        }).catch(err => {
                            this.swall({
                                type: 'error',
                                text: err.response.data.error,
                            })
                        })

                        viewModal.hide();
                    } else if (result.dismiss === 'cancel') {
                        Swal.fire({
                            text: "Your event was not deleted!.",
                            icon: "error",
                            buttonsStyling: false,
                            confirmButtonText: "Ok, got it!",
                            customClass: {
                                confirmButton: "btn btn-primary",
                            }
                        });
                    }
                });
            },
            initCalendar: function () {
                let calendarEl = document.getElementById('kt_calendar_app');
                let todayDate = moment().startOf('day');
                let YM = todayDate.format('YYYY-MM');
                let YESTERDAY = todayDate.clone().subtract(1, 'day').format('YYYY-MM-DD');
                let TODAY = todayDate.format('YYYY-MM-DD');
                let TOMORROW = todayDate.clone().add(1, 'day').format('YYYY-MM-DD');

                const self = this;

                this.calendar = new FullCalendar.Calendar(calendarEl, {

                    headerToolbar: {
                        left: 'prev,next today',
                        center: 'title',
                        right: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek'
                    },
                    locale: 'fr',
                    initialDate: TODAY,
                    initialView: 'listWeek',
                    navLinks: Boolean("{% if user.is_staff or user.is_superuser %} 1 {% endif %}"),
                    selectable: Boolean("{% if user.is_staff or user.is_superuser %} 1 {% endif %}"),
                    selectMirror: Boolean("{% if user.is_staff or user.is_superuser %} 1 {% endif %}"),
                    weekNumbers: true,

                    select: function (arg) {
                        self.handleNewEvent(arg);
                    },

                    eventClick: function (arg) {
                        self.handleViewEvent(arg)
                    },

                    editable: true,
                    dayMaxEvents: true,
                    events: this.shedules,
                });

                this.calendar.render();
            },
            handleNewEvent: function (ev) {

                this.initDatepickers(ev.start, ev.end)
                addModal.show();
            },
            handleViewEvent: function (ev) {
                elt = this.shedules.find(elt => elt.id == ev.event.id)

                //$()
                this.clickedElt = elt;

                viewModal.show();
            },
            initDatepickers: function (start = null, end = null) {
                flatpickr(startDatepicker, {
                    enableTime: false,
                    dateFormat: "Y-m-d",
                }).setDate(start ?? new Date());

                flatpickr(endDatepicker, {
                    enableTime: false,
                    dateFormat: "Y-m-d",
                }).setDate(start ?? new Date());

                flatpickr(startTimepicker, {
                    enableTime: true,
                    noCalendar: true,
                    dateFormat: "H:i",
                }).setDate(end ?? new Date());

                flatpickr(endTimepicker, {
                    enableTime: true,
                    noCalendar: true,
                    dateFormat: "H:i",
                }).setDate(end ?? new Date());
            },
            swall: function (options) {
                Swal.fire({
                    text: options.text,
                    icon: options.type,
                    buttonsStyling: false,
                    confirmButtonText: "D'accord, c'est compris!",
                    customClass: {
                        confirmButton: "btn btn-primary"
                    }
                });
            },
        },
        mounted() {
            $(document).ready(() => {
                form = document.querySelector('#kt_modal_add_event_form');
                startDatepicker = form.querySelector('#kt_calendar_datepicker_start_date');
                endDatepicker = form.querySelector('#kt_calendar_datepicker_end_date');
                startTimepicker = form.querySelector('#kt_calendar_datepicker_start_time');
                endTimepicker = form.querySelector('#kt_calendar_datepicker_end_time');
                addModal = new bootstrap.Modal($('#kt_modal_add_event'));
                editModal = new bootstrap.Modal($('#kt_modal_edit_event'));
                viewModal = new bootstrap.Modal($('#kt_modal_view_event'));

                this.initDatepickers();

                $("[data-control='select2-custom']").select2({
                    dropdownParent: $("#kt_modal_add_event")
                });
                $("[data-control='select3-custom']").select2({
                    dropdownParent: $("#kt_modal_edit_event")
                });

            });
            this.getShedules();
        },

    }).mount('#main')
</script>
{% endblock %}